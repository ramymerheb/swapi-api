{"version":3,"sources":["webpack:///src/app/home/home.page.html","webpack:///src/app/_services/films.service.ts","webpack:///src/app/home/home-routing.module.ts","webpack:///src/app/home/home.module.ts","webpack:///src/app/home/home.page.scss","webpack:///src/app/home/home.page.ts"],"names":["FilmsService","httpService","storage","platform","url","baseAppUrlSecure","get","providedIn","routes","path","component","HomePageRoutingModule","imports","forChild","exports","HomePageModule","declarations","HomePage","charactersService","filmsService","nextPagePageUrl","keyword","failedLoadAttempts","tryLoadMoreData","l","document","getElementById","console","log","height","scrollHeight","getCharacters","dataListFillInterval","setInterval","clearInterval","characters","getFilmsList","subscribe","data","filmsList","results","map","movie","set","filmsLoaded","ev","detail","complete","event","getCharactersList","next","id","replace","baseAppUrl","concat","target","value","selector","template"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+ECM2B;;;UAM7BA,YAAY;AACvB,8BACUC,WADV,EAEUC,OAFV,EAGSC,QAHT,EAG2B;AAAA;;AAFjB,eAAAF,WAAA,GAAAA,WAAA;AACA,eAAAC,OAAA,GAAAA,OAAA;AACD,eAAAC,QAAA,GAAAA,QAAA;AACL;;AALmB;AAAA;AAAA,yCAOX;AACV,gBAAIC,GAAG,GAAI,sEAAYC,gBAAZ,GAA+B,QAA1C;AACC,mBAAO,KAAKJ,WAAL,CAAiBK,GAAjB,CAAgCF,GAAhC,CAAP;AACF;AAVsB;;AAAA;AAAA,S;;;;gBAXhB;;gBAKA;;gBADA;;;;AAOIJ,kBAAY,6DAHxB,iEAAW;AACVO,kBAAU,EAAE;AADF,OAAX,CAGwB,GAAZP,YAAY,CAAZ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACPb,UAAMQ,MAAM,GAAW,CACrB;AACEC,YAAI,EAAE,EADR;AAEEC,iBAAS,EAAE;AAFb,OADqB,CAAvB;;UAWaC,qBAAqB;AAAA;AAAA,O;;AAArBA,2BAAqB,6DAJjC,+DAAS;AACRC,eAAO,EAAE,CAAC,6DAAaC,QAAb,CAAsBL,MAAtB,CAAD,CADD;AAERM,eAAO,EAAE,CAAC,4DAAD;AAFD,OAAT,CAIiC,GAArBH,qBAAqB,CAArB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCCAI,cAAc;AAAA;AAAA,O;;AAAdA,oBAAc,6DAT1B,+DAAS;AACRH,eAAO,EAAE,CACP,4DADO,EAEP,0DAFO,EAGP,0DAHO,EAIP,0EAJO,CADD;AAORI,oBAAY,EAAE,CAAC,mDAAD;AAPN,OAAT,CAS0B,GAAdD,cAAc,CAAd;;;;;;;;;;;;;;;;ACjBb;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCaFE,QAAQ;AAQnB,0BACUC,iBADV,EAEUC,YAFV,EAGUjB,OAHV,EAISC,QAJT,EAI2B;AAAA;;AAAA;;AAHjB,eAAAe,iBAAA,GAAAA,iBAAA;AACA,eAAAC,YAAA,GAAAA,YAAA;AACA,eAAAjB,OAAA,GAAAA,OAAA;AACD,eAAAC,QAAA,GAAAA,QAAA;AAXT,eAAAiB,eAAA,GAAkB,IAAlB;AAEA,eAAAC,OAAA,GAAkB,EAAlB;AACA,eAAAC,kBAAA,GAA6B,CAA7B,CAQ2B,CAuB3B;;AACC,eAAAC,eAAA,GAAkB,YAAM;AACvB,gBAAIC,CAAC,GAAGC,QAAQ,CAACC,cAAT,CAAwB,UAAxB,CAAR;AACAC,mBAAO,CAACC,GAAR,CAAY,KAAI,CAACzB,QAAL,CAAc0B,MAAd,EAAZ;AACAF,mBAAO,CAACC,GAAR,CAAYJ,CAAC,CAACM,YAAd;AACAH,mBAAO,CAACC,GAAR,CAAaJ,CAAC,IACX,KAAI,CAACrB,QAAL,CAAc0B,MAAd,KAAyBL,CAAC,CAACM,YADjB,IACkC;AAC7C,iBAAI,CAACR,kBAAL,GAA0B,EAF5B,CAE+B;AAF/B;;AAKA,gBAAIE,CAAC,IACA,KAAI,CAACrB,QAAL,CAAc0B,MAAd,KAAyBL,CAAC,CAACM,YAD5B,IAC6C;AAC5C,iBAAI,CAACR,kBAAL,GAA0B,EAF/B,CAEmC;AAFnC,cAGC;AACC,qBAAI,CAACS,aAAL,CAAmB,KAAI,CAACX,eAAxB;;AACA,qBAAI,CAACY,oBAAL,GAA4BC,WAAW,CAAC,KAAI,CAACV,eAAN,EAAuB,GAAvB,CAAvC;AACD,eAND,MAMK;AACHW,2BAAa,CAAC,KAAI,CAACF,oBAAN,CAAb;AACD;AACF,WAlBA;AArBA;;AAfkB;AAAA;AAAA,qCAiBR;AAAA;;AACT,iBAAKG,UAAL,GAAkB,EAAlB,CADS,CAEL;;AACJ,iBAAKhB,YAAL,CAAkBiB,YAAlB,GAAiCC,SAAjC,CACE,UAAAC,IAAI,EAAI;AACN,kBAAMC,SAAS,GAAG,EAAlB;AACED,kBAAI,CAACE,OAAL,CAAaC,GAAb,CACI,UAAAC,KAAK,EAAI;AACLH,yBAAS,CAAEG,KAAK,CAAC,YAAD,CAAP,CAAT,GAAmCA,KAAK,CAAC,OAAD,CAAxC;AACH,eAHL;;AAKA,oBAAI,CAACxC,OAAL,CAAayC,GAAb,CAAiB,OAAjB,EAA0BJ,SAA1B;;AACA,oBAAI,CAACK,WAAL,GAAmB,IAAnB;AACD,aAVL;AAYA,iBAAKrB,eAAL;AACD;AAjCkB;AAAA;AAAA,kCAuDXsB,EAvDW,EAuDP;AACV,iBAAKV,UAAL,GAAkB,EAAlB;AACA,iBAAKf,eAAL,GAAqB,IAArB;AACA,iBAAKW,aAAL,CAAmB,KAAKX,eAAxB,EAAyC,EAAzC;AACAyB,cAAE,CAACC,MAAH,CAAUC,QAAV;AACD;AA5DkB;AAAA;AAAA,wCA8DL3B,eA9DK,EA8DY4B,KA9DZ,EA8DkB;AAAA;;AACnC,iBAAK9B,iBAAL,CAAuB+B,iBAAvB,CAAyC7B,eAAzC,EAA0D,KAAKC,OAA/D,EAAwEgB,SAAxE,CACE,UAAAC,IAAI,EAAI;AACN,oBAAI,CAAClB,eAAL,GAAuBkB,IAAI,CAACY,IAA5B;AACAZ,kBAAI,CAACE,OAAL,CAAaC,GAAb,CAAiB,UAAAH,IAAI,EAAI;AACvB;AACAA,oBAAI,CAACa,EAAL,GAAUb,IAAI,CAAClC,GAAL,CAASgD,OAAT,CAAiB,sEAAYC,UAAZ,GAAuB,SAAxC,EAAmD,EAAnD,CAAV;AACD,eAHD;AAKA,oBAAI,CAAClB,UAAL,GAAmB,MAAI,CAACA,UAAL,CAAgBmB,MAAhB,CAAwBhB,IAAI,CAACE,OAA7B,CAAnB;AAEA,kBAAIpB,eAAe,IAAI,IAAnB,IAA2B4B,KAA/B,EACIA,KAAK,CAACO,MAAN,CAAaR,QAAb;AACJ,oBAAI,CAACzB,kBAAL;AACD,aAbH;AAeD;AA9EkB;AAAA;AAAA,mCAgFV0B,KAhFU,EAgFH;AACd,iBAAKjB,aAAL,CAAmB,KAAKX,eAAxB,EAAyC4B,KAAzC;AACD;AAlFkB;AAAA;AAAA,iCAoFZA,KApFY,EAoFL;AACZ,iBAAKb,UAAL,GAAkB,EAAlB;AACA,iBAAKf,eAAL,GAAqB,IAArB;AACA,iBAAKC,OAAL,GAAe2B,KAAK,CAACF,MAAN,CAAaU,KAA5B;AACA,iBAAKzB,aAAL,CAAmB,KAAKX,eAAxB,EAAyC,EAAzC;AACC;AAzFgB;;AAAA;AAAA,S;;;;gBAXZ;;gBAGA;;gBACA;;gBAFA;;;;AASIH,cAAQ,6DALpB,gEAAU;AACTwC,gBAAQ,EAAE,UADD;AAETC,gBAAQ,EAAR;AAAA;AAAA,0FAFS;;;;AAAA,OAAV,CAKoB,GAARzC,QAAQ,CAAR","file":"home-home-module-es5.js","sourcesContent":["export default \"<ion-header [translucent]=\\\"true\\\">\\n  <ion-toolbar>\\n    <ion-title size=\\\"small\\\">\\n      Star Wars character list\\n    </ion-title>\\n  </ion-toolbar>\\n  <ion-searchbar\\n  (ionChange)=\\\"filter($event)\\\"\\n  *ngIf=\\\"platform.is('android')\\\"\\n  ></ion-searchbar>\\n</ion-header>\\n\\n<ion-content [fullscreen]=\\\"true\\\">\\n  <ion-refresher slot=\\\"fixed\\\" (ionRefresh)=\\\"refresh($event)\\\">\\n    <ion-refresher-content></ion-refresher-content>\\n  </ion-refresher>\\n  \\n  <ion-header collapse=\\\"condense\\\">\\n    <ion-toolbar>\\n      <ion-title size=\\\"small\\\">\\n        Star Wars character list\\n      </ion-title>\\n    </ion-toolbar>\\n    <ion-toolbar>\\n      <ion-searchbar  style=\\\"z-index:999999999999\\\"\\n      (ionChange)=\\\"filter($event)\\\"\\n      ></ion-searchbar>\\n    </ion-toolbar>\\n  </ion-header>\\n  <h2 class=\\\"mid\\\" *ngIf =\\\"characters.length == 0 && keyword == '' && !filmsLoaded \\\">Loading Characters</h2>\\n  <ion-spinner *ngIf =\\\"characters.length == 0  && keyword == '' && !filmsLoaded \\\"></ion-spinner>\\n  <h2 class=\\\"mid\\\" *ngIf =\\\"characters.length == 0 && keyword != ''\\\">No Data Available</h2>\\n\\n  \\n  <ion-list  id=\\\"datalist\\\" #datalist>\\n    <ion-item *ngFor=\\\"let character of characters\\\"  [routerLink]=\\\"['/character/' + character.id ]\\\">\\n      <ion-label class=\\\"ion-text-wrap\\\">\\n        <h2>\\n          {{ character.name   }}\\n        </h2>\\n      </ion-label>\\n    </ion-item>\\n  </ion-list>\\n\\n  <ion-infinite-scroll threshold=\\\"50%\\\" (ionInfinite)=\\\"loadData($event)\\\">\\n    <ion-infinite-scroll-content\\n      loadingSpinner=\\\"bubbles\\\"\\n      loadingText=\\\"Loading more character...\\\">\\n    </ion-infinite-scroll-content>\\n  </ion-infinite-scroll>\\n\\n</ion-content>\";","import { Injectable } from '@angular/core';\r\nimport { HttpClient, } from '@angular/common/http';\r\nimport { environment, } from '../../environments/environment';\r\nimport { filmsList } from '../_models/films.model';\r\nimport { NativeStorage } from '@ionic-native/native-storage/ngx';\r\nimport { Platform } from '@ionic/angular';\r\nimport { Storage } from '@ionic/storage'; // This line added manually.\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FilmsService {\r\n  constructor(\r\n    private httpService: HttpClient,\r\n    private storage: Storage,\r\n    public platform: Platform\r\n  ) {}\r\n\r\n  getFilmsList(): Observable<any> {\r\n    let url =  environment.baseAppUrlSecure + 'films/'  ; \r\n     return this.httpService.get<filmsList>(url)\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { HomePage } from './home.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: HomePage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class HomePageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule } from '@angular/forms';\n\nimport { HomePage } from './home.page';\nimport { HomePageRoutingModule } from './home-routing.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    HomePageRoutingModule\n  ],\n  declarations: [HomePage]\n})\nexport class HomePageModule {}\n","export default \"ion-spinner {\\n  display: block;\\n  margin: auto;\\n}\\n\\n.mid {\\n  text-align: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvaG9tZS9ob21lLnBhZ2Uuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGNBQUE7RUFDQSxZQUFBO0FBQ0o7O0FBRUE7RUFDSSxrQkFBQTtBQUNKIiwiZmlsZSI6InNyYy9hcHAvaG9tZS9ob21lLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbImlvbi1zcGlubmVyIHtcclxuICAgIGRpc3BsYXk6IGJsb2NrO1xyXG4gICAgbWFyZ2luOiBhdXRvO1xyXG4gIH1cclxuXHJcbi5taWQge1xyXG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xyXG4gIH0iXX0= */\";","import { Component, OnInit } from '@angular/core';\nimport { character } from '../_models/characters.model';\nimport { CharactersService } from '../_services/characters.service';\nimport { environment } from '../../environments/environment';\nimport { Platform } from '@ionic/angular';\nimport { FilmsService } from '../_services/films.service';\nimport { Storage } from '@ionic/storage';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: 'home.page.html',\n  styleUrls: ['home.page.scss'],\n})\nexport class HomePage implements OnInit {\n  nextPagePageUrl = null;\n  characters: character[];\n  keyword: string = \"\";\n  failedLoadAttempts: number = 0;\n  filmsLoaded: {};\n  dataListFillInterval: any;\n\n  constructor(\n    private charactersService: CharactersService,\n    private filmsService: FilmsService,\n    private storage: Storage,\n    public platform: Platform\n  ){\n    \n  }\n\n  ngOnInit() {\n    this.characters = []\n        //we get list of all available movies create an object of movie id and movie name and save it in local storage which will make it faster for us to assign the films of each actors\n    this.filmsService.getFilmsList().subscribe(\n      data => {\n        const filmsList = {}\n          data.results.map(\n              movie => {\n                  filmsList[ movie['episode_id'] ] = movie['title'] \n              }\n          )\n          this.storage.set('films', filmsList);\n          this.filmsLoaded = true;\n        }\n  );\n    this.tryLoadMoreData()   \n  }\n\n  //to force loading elements until the list height is greater than device-height\n   tryLoadMoreData = () => {\n    let l = document.getElementById('datalist');  \n    console.log(this.platform.height() )  \n    console.log(l.scrollHeight )  \n    console.log( l &&\n      (this.platform.height() > l.scrollHeight) && //is the list shorter than the screen\n      this.failedLoadAttempts < 20 //we should not try forever\n  )\n\n    if( l &&\n        (this.platform.height() > l.scrollHeight) && //is the list shorter than the screen\n        (this.failedLoadAttempts < 20) //we should not try forever\n    ){\n      this.getCharacters(this.nextPagePageUrl);\n      this.dataListFillInterval = setInterval(this.tryLoadMoreData, 500);\n    }else{\n      clearInterval(this.dataListFillInterval);\n    }\n  } \n  refresh(ev) {\n    this.characters = []\n    this.nextPagePageUrl=null\n    this.getCharacters(this.nextPagePageUrl, \"\");\n    ev.detail.complete();\n  }\n\n  getCharacters(nextPagePageUrl, event? ){\n    this.charactersService.getCharactersList(nextPagePageUrl, this.keyword).subscribe(\n      data => {\n        this.nextPagePageUrl = data.next\n        data.results.map(data => {\n          //to retrun the character id\n          data.id = data.url.replace(environment.baseAppUrl+'people/', \"\");\n        })\n\n        this.characters =  this.characters.concat( data.results )\n\n        if (nextPagePageUrl != null && event)\n            event.target.complete();\n        this.failedLoadAttempts ++ \n      }\n    )\n  }\n  \n  loadData(event) {\n    this.getCharacters(this.nextPagePageUrl, event);\n  }\n\n  filter(event) {\n    this.characters = []\n    this.nextPagePageUrl=null\n    this.keyword = event.detail.value;\n    this.getCharacters(this.nextPagePageUrl, \"\");\n    }\n}\n"]}